<!DOCTYPE html>
<html>
<head>
<!DOCTYPE html>
<html lang="en-gb">



<link rel="stylesheet" href="/css/fonts.css">
<link rel="stylesheet" href="/css/main-site.css">
<link rel="stylesheet" href="/css/fa5-all.css">
<style type="text/css">
    /* Google Fonts */
 @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap'); 

body {
	background-color: white;
	color: #404040;
}

/* Links */

a {
  color: #4254A7;
}

a:hover {
  color: #4254A7;
}

a:focus {
  outline-color: #4254A7;
}

.column25-left .sectionTitle a:hover:not(.current),
.column16-left .sectionTitle a:hover:not(.current) { /* Tutorial left sidebar */
  color: #404040;
}

.icon-attribution, 
.icon-attribution a {
  color: #404040;
  opacity: 75%;
}


/* Landing page content bands */

#homeContent .band.first {
  background-color: white;
}

#homeContent .band.second {
  background-color: #fcfcfc;
}

#homeContent .band.third {
  background-color: white;
}

/* Top navigation bar menu */

#rStudioHeader {
  background-color: white;
  color: black;
}

#rStudioHeader .productName {
  color: #4254A7;
}

#rStudioHeader .productName:hover,
#rStudioHeader .productName:focus {
  color: 00000075;
}

#rStudioHeader #menu .menuItem.a {
  background-color: #75aadb;
  color: black;
}

#rStudioHeader #menu .menuItem:hover {
  background-color: white;
  color: #4254A7;
}

#rStudioHeader #menu .menuItem.current {
  background-color: #fcfcfc;
  color: #4254A7;
  text-decoration: none;
}

/* Footer */

#rStudioFooter.band {
  background-color: #4254a730;
}

#rStudioFooter .bandContent #copyright {
  color: #4254A7;
}

/* Tables */

table tbody tr:nth-child(even){
  background-color: #fcfcfc;
}

table tbody tr:nth-child(odd){
  background-color: #1a162d10;
}

.latest {
  border-top: .5em solid #dae8f6;
}


/* ------Accent Font------- */



  h1, h2, 
  .article-title:not(a), /* Title on single pages, but not the Learn list article links*/
  div.tagline, /* homepage bands */
  #TableOfContents a, /* Sidebar on regular pages*/
  .articleCategory a, /* Sidebar on Blog & Learn list pages */
  .column75 .sectionTitle:not(.back-to), /* e.g. Blog list title, NOT "back to learn" */
  .column25-left .section:nth-child(n+2) .sectionTitle, /* Tutorial sidebar, all but 1st child */
  .column16-left .section:nth-child(n+2) .sectionTitle,
  a.learn-top-nav-item,  /* Bulleted toc items on Learn list page */
  .itemTitle, /* Blog list page titles & Learn List page subsection Titles */
  .tags-list a    /* taxonomy tags on Tutorial page, e.g. packages */                
                            { 
    font-family: 'Libre Baskerville' ;
  }





/* ----Accent color for headers, toc, etc.----- */



  h1,
  div.sectionTitle {
    color: #4254A7;
  }
  
  /* Sidebar links */
  
  a.learn-top-nav-item, /* Learn list page bulleted toc */
  #TableOfContents a,
  .articleCategory a,
  .column25-left .section:nth-child(n+2) a.sectionTitle,
  .column16-left .section:nth-child(n+2) a.sectionTitle { 
    color: #4254A7;
    opacity: .8;
  }
  
  .column25-left .section:nth-child(n+2) a.sectionTitle.current,
  .column16-left .section:nth-child(n+2) a.sectionTitle.current { 
    color: #4254A7;
  }
  
  a.learn-top-nav-item:hover,
  #TableOfContents a:hover,
  .articleCategory a:hover,
  .column25-left .section:nth-child(n+2) a.sectionTitle:hover,
  .column16-left .section:nth-child(n+2) a.sectionTitle:hover {
    color: #333850eb; 
    opacity: 95%;
    text-decoration: none;
  }
  
  .column25-left .sectionTitle.start:first-of-type a,
  .column16-left .sectionTitle.start:first-of-type a {
    color: #4254A7;
  }
  
  .column25-left .sectionTitle.current,
  .column16-left .sectionTitle.current {
    color: #4254A7;
  }
  
  /* headers and accent colors */
  
  .article-title,             /* Most page titles */
  .column75 div.sectionTitle {  /* Learn page section title */
    color: #4254A7;
  }
  
  h2 {
    color: #333850eb;
  }
  
  .itemTitle a { /* For Learn Page headers */
    color: #333850eb;
  }
  
  .itemTitle a:hover { /* For Learn List Page headers */
    color: #333850eb;
    opacity: 80%;
    text-decoration: none;
  }
  
  h3 {
    color: #333850eb;
    opacity: 95%;
  }
  
  h3 a {
    color: #4254A7;
    /*text-transform: none;
    font-size: 1.5em;
    letter-spacing: normal; */ /* was in tm, but check if i need here? */
  }
  
  h4 {
    color: #333850eb;
    opacity: 90%;
  }
  
  /* taxonomy tags, e.g. tutorial package links*/
  
  .tags-list .learning-objective {
    color: #333850eb;
    opacity: 85%;
  }
  
  .tags-list a {
    color: #333850eb;
    opacity: 56%;
  }
  
  .tags-list a:hover {
    opacity: 95%;
  }



/* Custom colored bullets */



  /*.article-content ul{
    list-style: none;
  } */

  .article-content ul li::before {
  	content: "\2022";
  	color: #f6b73c ;
  	display: inline-block;
  	width: 1.5em;
  	margin-left: -1.7em;
  }
  	
  .article-content ul > li > p {
    display: inline;
  }

  .article-content ul > li { /*to add back in space between bullet items that I took away by making p display inline */
    margin-top: 1em;
    margin-bottom: 1em;
  }
  
  .learn-top-nav ul li::before, /* For learn list page */
  .tutorial #TableOfContents ul li::before { /* For tutorials toc bullets */
  	content: "\2022";
  	color: #f6b73c ;
  	display: inline-block;
  	width: 1.5em;
  	margin-left: -1.8em; 
  }

.article-content ul, /* Regular lists */
.learn-top-nav ul,
.tutorial #TableOfContents ul {
  	list-style: none;
  	line-height: 1.6em;
  	padding-left: 2.5em;
  	/* margin-bottom: 0; */
  }
  
/* But also give div tip outline the same color as bullets*/

div.note, 
div.rstudio-tip, 
div.warning {
  border-color: #f6b73c ;
}
    



/* ------Capitalization of Headers------- */


  
  div.tagline {
    font-size: 1.2rem !important;
    text-transform: uppercase;
    font-weight: bold;
    letter-spacing: 2pt;
  }
  
  #menu {
    text-transform: uppercase;
    letter-spacing: 2pt;
    font-size: 0.9rem !important;
  }
  
  .column25 .sectionTitle,
  .column25 .sectionTitle a,
  .column16 .sectionTitle,
  .column16 .sectionTitle a {
    text-transform: uppercase;
    letter-spacing: 2pt;
    font-size: 0.8rem;
    font-weight: bold;
  }
  
  .icon-attribution, 
  .icon-attribution a {
    text-transform: uppercase;
  }
  
  /* Getting Started / Tutorial sidebar title */
  .column25-left .sectionTitle.start:first-of-type a,
  .column16-left .sectionTitle.start:first-of-type a {
    text-transform: uppercase;
    letter-spacing: 2pt;
    font-weight: bold;
    font-size: 0.8rem;
  }
  
  /*.e.g "Back to Learn" link */
  .column75 .section .sectionTitle a {
    text-transform: uppercase;
    letter-spacing: 2pt;
    font-weight: bold;
    font-size: 0.8rem;
  }
  
  /*  */
  

  

/* -----Hexes------*/


  #homeContent .band.first .bandContent {
    background-image: url(../css/images/tidy-back-01-thin.svg);
  }
  
  #homeContent .band.second .bandContent {
    background-image: url(../css/images/tidy-back-02-thin.svg);
  }
  
  #homeContent .band.third .bandContent {
    background-image: url(../css/images/tidy-back-03-thin.svg);
  }
  
  .package-section .packages .package {
    background-image: url(../css/images/tidy-packages-back-01-thin.svg); 
  }

  .package-section .packages .package:first-of-type {
      background-image: url(../css/images/tidy-packages-back-02-thin.svg); 
  }

  .package-section .packages .package:last-of-type {
      background-image: url(../css/images/tidy-packages-back-03-thin.svg); 
  } 



/*----- Borders------ */



  #rStudioHeader {
    box-shadow: 0 1px 0px 0px rgba(0, 0, 0, 0.15);
    -moz-box-shadow: 0 1px 0px 0px rgba(0, 0, 0, 0.15);
    -webkit-box-shadow: 0 1px 0px 0px rgba(0, 0, 0, 0.15);
  }
  
  #homeContent .band.second {
    border-bottom: solid 1px #d9d9d9;
    border-top: solid 1px #d9d9d9;
  }
  
  .column25,
  .column16 {
    border-left: solid #d9d9d9 1px;
  }
  
  .column25-left {
    padding-right: 3em;
    border-right: solid #d9d9d9 1px;
}

  .column16-left {
    padding-right: 1.5em;
    border-right: solid #d9d9d9 1px;
}

  .article-content.learn-list ul {
      border-left: 1px solid #d9d9d9;
  }



/*--- Event Stickies ---*/


  .event {
    -moz-box-shadow: 0 0px 0px 0px rgba(0, 0, 0, 0.1);
    -webkit-box-shadow: 0 0px 0px 0px rgba(0, 0, 0, 0.1);
    box-shadow: 0 0px 0px 0px rgba(0, 0, 0, 0.1);
  }




  .event:nth-child(2) {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg); 
  }
  .event:nth-child(3) {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg); 
  }




  .section .event {
    background-color: #eab0c41a;
  }




  .section .event {
    border-top: 7pt solid #a19ea936;
  }




  .section .event a{
      color: #1a162d;
  }




  .section .event {
      color: #404040;
  }


/* ------Test Drive Button-------*/














 

</style>

  <link rel="stylesheet" href="/css/">




<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.68.3" />
<title>nutriverse</title>
<meta property="og:title" content="rules 0.0.1" />
<meta property="og:description" content="The rules package is on CRAN and enables rule-based models for tidymodels.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2020/05/rules-0-0-1/" />



<meta property="twitter:card" content="summary_large_image">





    <meta property="og:title" content="rules 0.0.1 - nutriverse">
    <meta property="description" content="The rules package is on CRAN and enables rule-based models for tidymodels.
">
    <meta property="og:description" content="The rules package is on CRAN and enables rule-based models for tidymodels.
">

    
    
    
    
    
    
        <meta property="og:image" content="/blog/2020/05/rules-0-0-1/rules-0-0-1-sq.jpg" >
    

    
    
    
    
        <meta name="twitter:image" content="/blog/2020/05/rules-0-0-1/rules-0-0-1-wd.jpg" >
    





<link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png" />
<link rel="manifest" href="/images/favicons/site.webmanifest" />
<link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" />
<link rel="shortcut icon" href="/images/favicons/favicon.ico" />
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" href="/images/favicons/browserconfig.xml" >



<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/site.js"></script>



<link rel="icon" href="/images/favicon.ico" />


  
<script type="text/javascript" src="/js/clipboard.js"></script>






  


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

  







  <body>
    <div id="appTidyverseSite" class="shrinkHeader alwaysShrinkHeader">
      <div id="main">
        
        <div id="rStudioHeader">
          <div class="band">
            <div class="innards bandContent">
              <div>
                
                    <a href="/" class="nav-logo">
                      <img src="/images/Color/RStudio-Education.png" width="220.85" height="40" alt="RStudio Education">
                    </a>
              </div>
              <div id="menu">
  <div id="menuToggler"></div>
  <div id="menuItems" class="">
    
    
      
      
      
    <a class="menuItem " href="/packages/">Packages</a>
    
      
      
      
    <a class="menuItem current" href="/blog/">Blog</a>
    
      
      
      
    <a class="menuItem " href="/start/">Tutorials</a>
    
      
      
      
    <a class="menuItem " href="/learn/">Learn</a>
    
      
      
      
    <a class="menuItem " href="/help/">Help</a>
    
  </div>
</div>

            </div>
          </div>
        </div>
</head>
<body>


 




<div class="band padForHeader pushFooter">
  <div class="bandContent">
    <div class="full splitColumns withMobileMargins">
      <div class="column75">

      <h1 class="article-title">rules 0.0.1</h1>

      
      <div class="article-header" aria-hidden="true">
          
          <div class="photo">
          <img src='/blog/2020/05/rules-0-0-1/rules-0-0-1-wd.jpg'>
          </div>
          
        
        <div class="photoCredit">Photo by <a href="https://unsplash.com/photos/lu15z1m_KfM">Lili Popper</a>
        </div>
        
      </div>

      
      <span class="article-date">
        <i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2020/05/21
      </span>
      
      
        <p style="margin-bottom: 0.5em; margin-top: 0.85em;">
          <i class="fas fa-tags"></i>&nbsp;
      
          
            <a href="/tags/tidymodels/">tidymodels</a>, 
            <a href="/tags/rules/">rules</a></p>
      
      
      
      
        <p style="margin-top: 0.5em;">
        <i class="fas fa-user-circle fa-fw"></i>&nbsp;
        




  

  Max Kuhn
  



      
        </p>
      

      <div class="article-content">
      <p>We are happy to announce the release of the 
<a href="https://rules.tidymodels.org" target="_blank" rel="noopener">rules package</a> on 
<a href="https://cran.r-project.org/package=rules" target="_blank" rel="noopener">CRAN</a>. rules is another &ldquo;parsnip-adjacent&rdquo; package that enables a specific class of models within the tidymodels infrastructure.  rules currently contains three models:</p>
<ul>
<li>
<p><code>C5_rules()</code>: classification rule sets based on the C5.0 model.</p>
</li>
<li>
<p><code>cubist_rules()</code>: regression rules using Cubist.</p>
</li>
<li>
<p><code>rule_fit()</code>: classification or regression rules using the RuleFit model.</p>
</li>
</ul>
<p>If you aren&rsquo;t familiar with rule-based models, there is a 
<a href="https://rviews.rstudio.com/2020/05/21/modern-rule-based-models/" target="_blank" rel="noopener">companion blog post</a> that summarizes how they work.</p>
<p>Install rules from CRAN like so:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#00f">install.packages</span>(<span style="color:#ba2121">&#34;rules&#34;</span>)
</code></pre></div><p>Then attach it for use via:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#00f">library</span>(rules)
</code></pre></div><p>Here&rsquo;s an example of creating Cubist regression rules via the 
<a href="https://tune.tidymodels.org/" target="_blank" rel="noopener">parsnip package</a>:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#00f">library</span>(tidymodels)
<span style="color:#408080;font-style:italic">#&gt; ── Attaching packages ──────────────────────────────────── tidymodels 0.1.0 ──</span>
<span style="color:#408080;font-style:italic">#&gt; ✓ broom     0.5.6      ✓ recipes   0.1.12</span>
<span style="color:#408080;font-style:italic">#&gt; ✓ dials     0.0.6      ✓ rsample   0.0.6</span>
<span style="color:#408080;font-style:italic">#&gt; ✓ dplyr     0.8.5      ✓ tibble    3.0.1</span>
<span style="color:#408080;font-style:italic">#&gt; ✓ ggplot2   3.3.0      ✓ tune      0.1.0</span>
<span style="color:#408080;font-style:italic">#&gt; ✓ infer     0.5.1      ✓ workflows 0.1.1</span>
<span style="color:#408080;font-style:italic">#&gt; ✓ parsnip   0.1.1      ✓ yardstick 0.0.6</span>
<span style="color:#408080;font-style:italic">#&gt; ✓ purrr     0.3.4</span>
<span style="color:#408080;font-style:italic">#&gt; ── Conflicts ─────────────────────────────────────── tidymodels_conflicts() ──</span>
<span style="color:#408080;font-style:italic">#&gt; x purrr::accumulate() masks foreach::accumulate()</span>
<span style="color:#408080;font-style:italic">#&gt; x purrr::discard()    masks scales::discard()</span>
<span style="color:#408080;font-style:italic">#&gt; x dplyr::filter()     masks stats::filter()</span>
<span style="color:#408080;font-style:italic">#&gt; x dplyr::lag()        masks stats::lag()</span>
<span style="color:#408080;font-style:italic">#&gt; x ggplot2::margin()   masks dials::margin()</span>
<span style="color:#408080;font-style:italic">#&gt; x recipes::step()     masks stats::step()</span>
<span style="color:#408080;font-style:italic">#&gt; x purrr::when()       masks foreach::when()</span>
<span style="color:#00f">library</span>(rules)

<span style="color:#00f">data</span>(car_prices, package <span style="color:#666">=</span> <span style="color:#ba2121">&#34;modeldata&#34;</span>)

<span style="color:#00f">set.seed</span>(<span style="color:#666">9932</span>)
car_split <span style="color:#666">&lt;-</span> <span style="color:#00f">initial_split</span>(car_prices)
car_tr <span style="color:#666">&lt;-</span> <span style="color:#00f">training</span>(car_split)
car_te <span style="color:#666">&lt;-</span>  <span style="color:#00f">testing</span>(car_split)

<span style="color:#408080;font-style:italic"># A single rule set:</span>
cubist_mod <span style="color:#666">&lt;-</span>
  <span style="color:#00f">cubist_rules</span>(neighbors <span style="color:#666">=</span> <span style="color:#666">7</span>) <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">set_engine</span>(<span style="color:#ba2121">&#34;Cubist&#34;</span>)

cubist_fit <span style="color:#666">&lt;-</span>
  cubist_mod <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">fit</span>(<span style="color:#00f">log10</span>(Price) <span style="color:#666">~</span> ., data <span style="color:#666">=</span> car_tr)

<span style="color:#00f">summary</span>(cubist_fit<span style="color:#666">$</span>fit)
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; Call:</span>
<span style="color:#408080;font-style:italic">#&gt; cubist.default(x = x, y = y, committees = 1)</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; Cubist [Release 2.07 GPL Edition]  Wed May 20 21:39:22 2020</span>
<span style="color:#408080;font-style:italic">#&gt; ---------------------------------</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     Target attribute `outcome&#39;</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; Read 603 cases (18 attributes) from undefined.data</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; Model:</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 1: [210 cases, mean 4.116360, range 3.94295 to 4.2505, est err 0.030756]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cylinder &lt;= 4</span>
<span style="color:#408080;font-style:italic">#&gt; 	Saab &lt;= 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 4.115185 + 0.12 Saab - 3.5e-06 Mileage + 0.017 Cylinder</span>
<span style="color:#408080;font-style:italic">#&gt; 	          - 0.087 hatchback - 0.029 Chevy + 0.046 wagon + 0.028 Leather</span>
<span style="color:#408080;font-style:italic">#&gt; 	          + 0.041 Cadillac - 0.024 sedan + 0.027 convertible</span>
<span style="color:#408080;font-style:italic">#&gt; 	          + 0.006 Doors + 0.012 Buick</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 2: [8 cases, mean 4.207121, range 4.13308 to 4.26696, est err 0.006589]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cylinder &gt; 4</span>
<span style="color:#408080;font-style:italic">#&gt; 	Saturn &gt; 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 3.88624 + 0.057 Cylinder + 0.2 Saab + 0.141 Cadillac</span>
<span style="color:#408080;font-style:italic">#&gt; 	          - 3.8e-06 Mileage - 0.054 sedan + 0.094 convertible</span>
<span style="color:#408080;font-style:italic">#&gt; 	          - 0.085 hatchback + 0.019 Doors + 0.04 Buick + 0.014 Cruise</span>
<span style="color:#408080;font-style:italic">#&gt; 	          + 0.01 Leather + 0.007 Sound + 0.007 Saturn</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 3: [33 cases, mean 4.229076, range 4.16741 to 4.29184, est err 0.012903]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cylinder &gt; 4</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cruise &lt;= 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 4.265627 - 3.7e-06 Mileage + 0.039 Chevy</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 4: [94 cases, mean 4.272727, range 4.18913 to 4.4427, est err 0.034717]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Mileage &gt; 3946</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cylinder &gt; 4</span>
<span style="color:#408080;font-style:italic">#&gt; 	Doors &gt; 2</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cruise &gt; 0</span>
<span style="color:#408080;font-style:italic">#&gt; 	Buick &lt;= 0</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cadillac &lt;= 0</span>
<span style="color:#408080;font-style:italic">#&gt; 	Saturn &lt;= 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 4.037203 + 0.051 Cylinder - 4.3e-06 Mileage + 0.061 Saab</span>
<span style="color:#408080;font-style:italic">#&gt; 	          + 0.044 Cadillac - 0.016 sedan + 0.029 convertible</span>
<span style="color:#408080;font-style:italic">#&gt; 	          - 0.026 hatchback + 0.006 Doors - 0.009 Chevy + 0.012 Buick</span>
<span style="color:#408080;font-style:italic">#&gt; 	          + 0.004 Cruise</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 5: [57 cases, mean 4.314541, range 4.17208 to 4.42864, est err 0.049758]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Buick &gt; 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 4.389884 - 3e-06 Mileage</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 6: [9 cases, mean 4.341528, range 4.23957 to 4.66962, est err 0.036309]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Mileage &lt;= 3946</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cylinder &gt; 4</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cadillac &lt;= 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 3.439093 + 5.28e-05 Mileage + 0.129 Cylinder</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 7: [43 cases, mean 4.354487, range 4.1778 to 4.60071, est err 0.031792]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cylinder &gt; 4</span>
<span style="color:#408080;font-style:italic">#&gt; 	Doors &lt;= 2</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cruise &gt; 0</span>
<span style="color:#408080;font-style:italic">#&gt; 	convertible &lt;= 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 3.40984 + 0.13 Cylinder + 0.116 Chevy - 2.7e-06 Mileage</span>
<span style="color:#408080;font-style:italic">#&gt; 	          + 0.037 Sound + 0.031 Leather</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 8: [85 cases, mean 4.462877, range 4.34723 to 4.58348, est err 0.023398]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Saab &gt; 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 4.522928 - 3.4e-06 Mileage + 0.064 Saab - 0.021 Doors</span>
<span style="color:#408080;font-style:italic">#&gt; 	          - 0.035 sedan + 0.009 Cylinder + 0.022 Cadillac</span>
<span style="color:#408080;font-style:italic">#&gt; 	          - 0.024 hatchback + 0.015 convertible - 0.004 Chevy</span>
<span style="color:#408080;font-style:italic">#&gt; 	          + 0.006 Buick</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 9: [60 cases, mean 4.592824, range 4.44778 to 4.84976, est err 0.041948]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cadillac &gt; 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 4.774347 - 0.103 Doors + 0.036 Cylinder - 3.4e-06 Mileage</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;   Rule 10: [7 cases, mean 4.625017, range 4.58911 to 4.6727, est err 0.006627]</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     if</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cylinder &gt; 4</span>
<span style="color:#408080;font-style:italic">#&gt; 	Cadillac &lt;= 0</span>
<span style="color:#408080;font-style:italic">#&gt; 	convertible &gt; 0</span>
<span style="color:#408080;font-style:italic">#&gt;     then</span>
<span style="color:#408080;font-style:italic">#&gt; 	outcome = 4.693132 - 3.9e-06 Mileage</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; Evaluation on training data (603 cases):</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;     Average  |error|           0.032526</span>
<span style="color:#408080;font-style:italic">#&gt;     Relative |error|               0.23</span>
<span style="color:#408080;font-style:italic">#&gt;     Correlation coefficient        0.97</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; 	Attribute usage:</span>
<span style="color:#408080;font-style:italic">#&gt; 	  Conds  Model</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; 	   67%    84%    Cylinder</span>
<span style="color:#408080;font-style:italic">#&gt; 	   49%    66%    Saab</span>
<span style="color:#408080;font-style:italic">#&gt; 	   28%    66%    Cadillac</span>
<span style="color:#408080;font-style:italic">#&gt; 	   28%    17%    Cruise</span>
<span style="color:#408080;font-style:italic">#&gt; 	   25%    66%    Buick</span>
<span style="color:#408080;font-style:italic">#&gt; 	   23%    75%    Doors</span>
<span style="color:#408080;font-style:italic">#&gt; 	   17%   100%    Mileage</span>
<span style="color:#408080;font-style:italic">#&gt; 	   17%     1%    Saturn</span>
<span style="color:#408080;font-style:italic">#&gt; 	    8%    66%    convertible</span>
<span style="color:#408080;font-style:italic">#&gt; 	          77%    Chevy</span>
<span style="color:#408080;font-style:italic">#&gt; 	          66%    hatchback</span>
<span style="color:#408080;font-style:italic">#&gt; 	          66%    sedan</span>
<span style="color:#408080;font-style:italic">#&gt; 	          43%    Leather</span>
<span style="color:#408080;font-style:italic">#&gt; 	          35%    wagon</span>
<span style="color:#408080;font-style:italic">#&gt; 	           8%    Sound</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; Time: 0.0 secs</span>

<span style="color:#00f">predict</span>(cubist_fit, car_te <span style="color:#666">%&gt;%</span> <span style="color:#00f">select</span>(<span style="color:#666">-</span>Price))
<span style="color:#408080;font-style:italic">#&gt; # A tibble: 201 x 1</span>
<span style="color:#408080;font-style:italic">#&gt;    .pred</span>
<span style="color:#408080;font-style:italic">#&gt;    &lt;dbl&gt;</span>
<span style="color:#408080;font-style:italic">#&gt;  1  4.32</span>
<span style="color:#408080;font-style:italic">#&gt;  2  4.49</span>
<span style="color:#408080;font-style:italic">#&gt;  3  4.54</span>
<span style="color:#408080;font-style:italic">#&gt;  4  4.54</span>
<span style="color:#408080;font-style:italic">#&gt;  5  4.43</span>
<span style="color:#408080;font-style:italic">#&gt;  6  4.43</span>
<span style="color:#408080;font-style:italic">#&gt;  7  4.46</span>
<span style="color:#408080;font-style:italic">#&gt;  8  4.44</span>
<span style="color:#408080;font-style:italic">#&gt;  9  4.37</span>
<span style="color:#408080;font-style:italic">#&gt; 10  4.48</span>
<span style="color:#408080;font-style:italic">#&gt; # … with 191 more rows</span>
</code></pre></div><p>The functions also work with the 
<a href="https://tune.tidymodels.org/" target="_blank" rel="noopener">tune package</a>. To optimize our model, the number of committees (similar to boosting iterations) and the number of nearest-neighbors are the primary parameters for tuning.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cb_grid <span style="color:#666">&lt;-</span> <span style="color:#00f">expand.grid</span>(committees <span style="color:#666">=</span> <span style="color:#666">1</span><span style="color:#666">:</span><span style="color:#666">30</span>, neighbors <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#666">1</span>, <span style="color:#666">3</span>, <span style="color:#666">5</span>, <span style="color:#666">7</span>, <span style="color:#666">9</span>))

<span style="color:#00f">set.seed</span>(<span style="color:#666">8226</span>)
car_folds <span style="color:#666">&lt;-</span> <span style="color:#00f">vfold_cv</span>(car_tr)

cubist_mod <span style="color:#666">&lt;-</span>
  <span style="color:#00f">cubist_rules</span>(neighbors <span style="color:#666">=</span> <span style="color:#00f">tune</span>(), committees <span style="color:#666">=</span> <span style="color:#00f">tune</span>()) <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">set_engine</span>(<span style="color:#ba2121">&#34;Cubist&#34;</span>)

car_tune_res <span style="color:#666">&lt;-</span>
  cubist_mod <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">tune_grid</span>(<span style="color:#00f">log10</span>(Price) <span style="color:#666">~</span> ., resamples <span style="color:#666">=</span> car_folds, grid <span style="color:#666">=</span> cb_grid)

car_tune_res <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">collect_metrics</span>() <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">filter</span>(.metric <span style="color:#666">==</span> <span style="color:#ba2121">&#34;rmse&#34;</span>) <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">mutate</span>(neighbors <span style="color:#666">=</span> <span style="color:#00f">factor</span>(neighbors)) <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">ggplot</span>(<span style="color:#00f">aes</span>(x <span style="color:#666">=</span> committees, y <span style="color:#666">=</span> mean, col <span style="color:#666">=</span> neighbors)) <span style="color:#666">+</span>
  <span style="color:#00f">geom_point</span>() <span style="color:#666">+</span>
  <span style="color:#00f">geom_line</span>() <span style="color:#666">+</span>
  <span style="color:#00f">scale_color_brewer</span>(palette <span style="color:#666">=</span> <span style="color:#ba2121">&#34;Dark2&#34;</span>) <span style="color:#666">+</span>
  <span style="color:#00f">theme</span>(legend.position <span style="color:#666">=</span> <span style="color:#ba2121">&#34;top&#34;</span>)
</code></pre></div><p><img src="/blog/2020-05-rules-0-0-1/index_files/figure-html/cb-tune-1.png" width="700px" style="display: block; margin: auto;" /></p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">
<span style="color:#00f">show_best</span>(car_tune_res, metric <span style="color:#666">=</span> <span style="color:#ba2121">&#34;rmse&#34;</span>)
<span style="color:#408080;font-style:italic">#&gt; # A tibble: 5 x 7</span>
<span style="color:#408080;font-style:italic">#&gt;   committees neighbors .metric .estimator   mean     n std_err</span>
<span style="color:#408080;font-style:italic">#&gt;        &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; 1          9         9 rmse    standard   0.0395    10 0.00133</span>
<span style="color:#408080;font-style:italic">#&gt; 2          5         9 rmse    standard   0.0395    10 0.00132</span>
<span style="color:#408080;font-style:italic">#&gt; 3         11         9 rmse    standard   0.0395    10 0.00133</span>
<span style="color:#408080;font-style:italic">#&gt; 4         13         9 rmse    standard   0.0395    10 0.00132</span>
<span style="color:#408080;font-style:italic">#&gt; 5          8         9 rmse    standard   0.0395    10 0.00131</span>

smallest_rmse <span style="color:#666">&lt;-</span> <span style="color:#00f">select_best</span>(car_tune_res, metric <span style="color:#666">=</span> <span style="color:#ba2121">&#34;rmse&#34;</span>)
smallest_rmse
<span style="color:#408080;font-style:italic">#&gt; # A tibble: 1 x 2</span>
<span style="color:#408080;font-style:italic">#&gt;   committees neighbors</span>
<span style="color:#408080;font-style:italic">#&gt;        &lt;int&gt;     &lt;dbl&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; 1          9         9</span>

final_cb_mod <span style="color:#666">&lt;-</span>
  cubist_mod <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">finalize_model</span>(smallest_rmse) <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">fit</span>(<span style="color:#00f">log10</span>(Price) <span style="color:#666">~</span> ., data <span style="color:#666">=</span> car_tr)
</code></pre></div><p>It appears that the benefit of using committees occurs in the first 10 iterations. The nearest-neighbor adjustment was important to obtaining good performance.</p>
<p>The test set results look good and are consistent with the resampling estimate of RMSE:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">test_pred <span style="color:#666">&lt;-</span>
  <span style="color:#00f">predict</span>(final_cb_mod, car_te) <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">bind_cols</span>(car_te <span style="color:#666">%&gt;%</span> <span style="color:#00f">select</span>(Price)) <span style="color:#666">%&gt;%</span>
  <span style="color:#00f">mutate</span>(Price <span style="color:#666">=</span> <span style="color:#00f">log10</span>(Price))

test_pred <span style="color:#666">%&gt;%</span> <span style="color:#00f">rmse</span>(Price, .pred)
<span style="color:#408080;font-style:italic">#&gt; # A tibble: 1 x 3</span>
<span style="color:#408080;font-style:italic">#&gt;   .metric .estimator .estimate</span>
<span style="color:#408080;font-style:italic">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span style="color:#408080;font-style:italic">#&gt; 1 rmse    standard      0.0382</span>

<span style="color:#00f">ggplot</span>(test_pred, <span style="color:#00f">aes</span>(x <span style="color:#666">=</span> .pred, y <span style="color:#666">=</span> Price)) <span style="color:#666">+</span>
  <span style="color:#00f">geom_abline</span>(col <span style="color:#666">=</span> <span style="color:#ba2121">&#34;green&#34;</span>, lty <span style="color:#666">=</span> <span style="color:#666">2</span>) <span style="color:#666">+</span>
  <span style="color:#00f">geom_point</span>(alpha <span style="color:#666">=</span> <span style="color:#666">0.5</span>) <span style="color:#666">+</span>
  <span style="color:#00f">coord_fixed</span>(ratio <span style="color:#666">=</span> <span style="color:#666">1</span>)
</code></pre></div><p><img src="/blog/2020-05-rules-0-0-1/index_files/figure-html/cb-test-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>I&rsquo;d like to thank 
<a href="https://github.com/holub008" target="_blank" rel="noopener">Karl Holub</a> for making the 
<a href="https://github.com/holub008/xrf" target="_blank" rel="noopener">xrf package</a> and accepting my PRs and changes.</p>

      </div>


      


      </div> 
      
      <div class="column25">
        <div class="section hideOnMobile">
          
        </div>
        <div class="section">
          





        </div>
      </div> 

    </div> 
  </div>  
</div> 



        <div id="rStudioFooter" class="band">
          <div class="bandContent">
            <div id="copyright">
              
              © <a href="https://www.rstudio.com/">RStudio Inc.</a>, 2020<br>
              
              
              Proudly supported by <a class="rstudioLogo" href="https://www.rstudio.com/" aria-label="RStudio Homepage"></a>
              
            </div>
            <div id="logos">
              <a href="https://github.com/rstudio-education" class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a>
              <a href="https://twitter.com/hashtag/rstats" class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a>
            </div>
          </div>
        </div>

      </div>  
    </div>  

    

    
<script src="/js/math-code.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    

  </body>
</html>

</body>
</html>
