<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>r-lib | nutriverse</title>
    <link>/tags/r-lib/</link>
      <atom:link href="/tags/r-lib/index.xml" rel="self" type="application/rss+xml" />
    <description>r-lib</description>
    <generator>Hugo -- gohugo.io</generator><language>en-gb</language><lastBuildDate>Mon, 27 Apr 2020 00:00:00 +0000</lastBuildDate>
    <item>
      <title>Self-cleaning test fixtures</title>
      <link>/blog/2020/04/self-cleaning-test-fixtures/</link>
      <pubDate>Mon, 27 Apr 2020 00:00:00 +0000</pubDate>
      <guid>/blog/2020/04/self-cleaning-test-fixtures/</guid>
      <description>&lt;p&gt;&lt;em&gt;Adapted from an internal presentation to the tidyverse team, which tells you something about the target reader. The primary audience for this post is R programmers and, especially, package developers. The problems identified and solved here are pretty niche! People who are mostly interested in R as a data analysis tool may not have direct use for this material. But the post offers something for anyone curious about the hazards of side effects and the various ways we can leave the world as you found it.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;test-hygiene&#34;&gt;Test hygiene&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Take nothing but memories, leave nothing but footprints.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€• Chief Si&amp;rsquo;ahl&lt;/p&gt;
&lt;p&gt;Ideally a test should leave the world exactly as it found it. Examples of things you might do inside a test and, therefore, need to undo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a file or directory&lt;/li&gt;
&lt;li&gt;Create a resource on an external system&lt;/li&gt;
&lt;li&gt;Set an R option&lt;/li&gt;
&lt;li&gt;Set an environment variable&lt;/li&gt;
&lt;li&gt;Change working directory&lt;/li&gt;
&lt;li&gt;Change an aspect of the tested package&amp;rsquo;s state&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Scrupulous attention to cleanup is more than just courtesy or being fastidious. It is also self-serving. The state of the world after test &lt;code&gt;i&lt;/code&gt; is the starting state for test &lt;code&gt;i + 1&lt;/code&gt;. Tests that change state willy-nilly eventually end up interfering with each other in ways that can be very difficult to debug. Most tests are written with an implicit assumption about the starting state, usually whatever &lt;em&gt;tabula rasa&lt;/em&gt; means for the target domain of your package. If you accumulate enough sloppy tests, you will eventually find yourself asking the programming equivalent of questions like &amp;ldquo;Who forgot to turn off the oven?&amp;rdquo; and &amp;ldquo;Who didn&amp;rsquo;t clean up after the dog?&amp;quot;.&lt;/p&gt;
&lt;p&gt;First, we lay some foundations that aren&amp;rsquo;t obviously related to tests, but just trust that we&amp;rsquo;ll get there eventually.&lt;/p&gt;
&lt;h2 id=&#34;the-onexit-pattern&#34;&gt;The &lt;code&gt;on.exit()&lt;/code&gt; pattern&lt;/h2&gt;
&lt;p&gt;If you want to clean up after yourself, how should you actually do it?&lt;/p&gt;
&lt;p&gt;The first function to know about is base R&amp;rsquo;s 
&lt;a href=&#34;https://rdrr.io/r/base/on.exit.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;on.exit()&lt;/code&gt;&lt;/a&gt;. You use it inside a function. In the function body, every time you do something that should be undone &lt;strong&gt;on exit&lt;/strong&gt;, you immediately register the cleanup code with &lt;code&gt;on.exit(expr, add = TRUE)&lt;/code&gt;&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a &lt;code&gt;sloppy()&lt;/code&gt; function that prints a number with a specific number of significant digits, by adjusting an R option.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;sloppy &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;function&lt;/span&gt;(x, sig_digits) {
  &lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(digits &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sig_digits)
  &lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(x)
}

&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.141593&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;sloppy&lt;/span&gt;(&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;, &lt;span style=&#34;color:#666&#34;&gt;2&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.1&lt;/span&gt;

&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice how &lt;code&gt;pi&lt;/code&gt; prints differently before and after the call to &lt;code&gt;sloppy()&lt;/code&gt;. Calling &lt;code&gt;sloppy()&lt;/code&gt; has a side effect: it changes the &lt;code&gt;digits&lt;/code&gt; option globally, not just within its own scope of operations. This is what we want to avoid.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Don&amp;rsquo;t worry, I&amp;rsquo;m restoring global state (specifically, the &lt;code&gt;digits&lt;/code&gt; option) behind the scenes here.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how to do better with &lt;code&gt;on.exit()&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;neat &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;function&lt;/span&gt;(x, sig_digits) {
  op &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(digits &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sig_digits)
  &lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(op), add &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)
  &lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(x)
}

&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.141593&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;neat&lt;/span&gt;(&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;, &lt;span style=&#34;color:#666&#34;&gt;2&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.1&lt;/span&gt;

&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.141593&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The use of &lt;code&gt;on.exit()&lt;/code&gt; ensures that &lt;code&gt;neat()&lt;/code&gt; leaves &lt;code&gt;digits&lt;/code&gt; the way that it found it. &lt;code&gt;on.exit()&lt;/code&gt; also works when you exit the function abnormally, i.e. due to error. This is why it&amp;rsquo;s a better choice than any do-it-yourself solution.&lt;/p&gt;
&lt;p&gt;But I promised to talk about tests! Never fear, &lt;code&gt;on.exit()&lt;/code&gt; also works inside a test.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;library&lt;/span&gt;(testthat)

&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2.718282&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;test_that&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;on.exit() works in a test&amp;#34;&lt;/span&gt;, {
  op &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(digits &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;2&lt;/span&gt;)
  &lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(op), add &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)
  out &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;format&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;))
  &lt;span style=&#34;color:#00f&#34;&gt;expect_equal&lt;/span&gt;(out, &lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;2.7&amp;#34;&lt;/span&gt;)
  &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# printing just for the benefit of the reader&lt;/span&gt;
  &lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(out) 
})
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;2.7&amp;#34;&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2.718282&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;on.exit()&lt;/code&gt; is a very useful function and provides enough inspiration for an entire package: withr (
&lt;a href=&#34;http://withr.r-lib.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;withr.r-lib.org&lt;/a&gt;), which is a Swiss army knife for managing state in very flexible ways. It&amp;rsquo;s what I usually use, in functions and tests, for situations like that above.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;For more background, the section about 
&lt;a href=&#34;https://adv-r.hadley.nz/functions.html#on-exit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Exit handlers&lt;/a&gt; in Advanced R is a good reference. The 
&lt;a href=&#34;https://github.com/r-lib/cleancall#readme&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cleancall package&lt;/a&gt; addresses a similar problem, but in the C code of an R package. cleancall is introduced in the blog post 
&lt;a href=&#34;https://www.tidyverse.org/blog/2019/05/resource-cleanup-in-c-and-the-r-api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Resource Cleanup in C and the R API&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;withrdefer&#34;&gt;&lt;code&gt;withr::defer()&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;withr::defer()&lt;/code&gt; is a more general version of &lt;code&gt;on.exit()&lt;/code&gt;. It can run cleanup for any environment, but defaults to the environment it was called in. Therefore, it works like &lt;code&gt;on.exit()&lt;/code&gt; inside a function &amp;ndash; an extremely important special case &amp;ndash; but the added flexibility means you can use it in more situations.&lt;/p&gt;
&lt;p&gt;Below I compare &lt;code&gt;on.exit()&lt;/code&gt; and &lt;code&gt;withr::defer()&lt;/code&gt; and I put the code inside &lt;code&gt;local()&lt;/code&gt;, instead of inside a function. This is meant to reinforce that cleanup can be relevant beyond function execution environments. It also gives you another tool to play with, in addition to toy functions and tests, in your own explorations of how to manage scope.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;library&lt;/span&gt;(withr)

&lt;span style=&#34;color:#00f&#34;&gt;local&lt;/span&gt;({
  &lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;first&amp;#34;&lt;/span&gt;))
  &lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;last&amp;#34;&lt;/span&gt;))  &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# this clobbers `print(&amp;#34;first&amp;#34;)` :(&lt;/span&gt;
})
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;last&amp;#34;&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;local&lt;/span&gt;({
  &lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;first&amp;#34;&lt;/span&gt;), add &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)
  &lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;last&amp;#34;&lt;/span&gt;), add &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)
})
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;first&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;last&amp;#34;&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;local&lt;/span&gt;({
  &lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;first&amp;#34;&lt;/span&gt;), add &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, after &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)
  &lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;last&amp;#34;&lt;/span&gt;), add &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;, after &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)
})
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;last&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;first&amp;#34;&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;local&lt;/span&gt;({
  &lt;span style=&#34;color:#00f&#34;&gt;defer&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;first&amp;#34;&lt;/span&gt;))
  &lt;span style=&#34;color:#00f&#34;&gt;defer&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;last&amp;#34;&lt;/span&gt;))
})
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;last&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;first&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This showcases the nice ergonomics of &lt;code&gt;defer()&lt;/code&gt;: each call &lt;em&gt;adds&lt;/em&gt; to the list of deferred tasks (vs. replaces) and, by default, adds to the &lt;em&gt;front&lt;/em&gt; of the stack (vs. the back). As you&amp;rsquo;ll see below, this turns out to matter in most real world usage&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;h2 id=&#34;withrlocal_&#34;&gt;&lt;code&gt;withr::local_*()&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;on.exit()&lt;/code&gt; usage has a very predictable, slightly clunky pattern. In &lt;code&gt;neat()&lt;/code&gt;, it looks like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;op &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(digits &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sig_digits)
&lt;span style=&#34;color:#00f&#34;&gt;on.exit&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(op), add &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;)      
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The first statement accomplishes two things at once: it sets the &lt;code&gt;digits&lt;/code&gt; option and captures its original value in &lt;code&gt;op&lt;/code&gt;. The second statement schedules the restoration of &lt;code&gt;digits&lt;/code&gt;. This order of operations is encouraged by the design of &lt;code&gt;options()&lt;/code&gt;, which returns the original values when it&amp;rsquo;s used as a setter.&lt;/p&gt;
&lt;p&gt;Here is the more general (and possibly slightly safer) approach: First, capture the current state. Then, immediately schedule the eventual restoration of this original state, so that this is arranged before any additional calls are made that could exit, e.g. throw an error. Last, make the desired state change.&lt;/p&gt;
&lt;p&gt;What if such a maneuver happens all over your package and you want to write a helper?&lt;/p&gt;
&lt;p&gt;You can&amp;rsquo;t wrap &lt;code&gt;on.exit()&lt;/code&gt; in your own helpers, because there&amp;rsquo;s no way to reach back up into the correct parent frame and schedule cleanup there. But with &lt;code&gt;defer()&lt;/code&gt;, we can! Here is such a custom helper, called &lt;code&gt;local_digits()&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;local_digits &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;function&lt;/span&gt;(sig_digits, env &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;parent.frame&lt;/span&gt;()) {
  op &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(digits &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sig_digits)
  &lt;span style=&#34;color:#00f&#34;&gt;defer&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(op), env &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; env)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can use it to keep any manipulation of &lt;code&gt;digits&lt;/code&gt; local to a test (or function).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2.718282&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;test_that&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;withr lets us write custom helpers for local state manipulation&amp;#34;&lt;/span&gt;, {
  &lt;span style=&#34;color:#00f&#34;&gt;local_digits&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;20&lt;/span&gt;)
  &lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;))
})
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2.7182818284590450908&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2.718282&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;test_that&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;we can even make multiple calls to local_digits()&amp;#34;&lt;/span&gt;, {
  &lt;span style=&#34;color:#00f&#34;&gt;local_digits&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;)
  &lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;))
  &lt;span style=&#34;color:#00f&#34;&gt;local_digits&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;3&lt;/span&gt;)
  &lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;))
  &lt;span style=&#34;color:#00f&#34;&gt;local_digits&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;5&lt;/span&gt;)
  &lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;))
})
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2.72&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2.7183&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;exp&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2.718282&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The ability to write &lt;code&gt;on.exit()&lt;/code&gt;-like functions, customized to your own needs, is very empowering. However, you may not even need to. There are certain state changes that come up over and over again, for all of us. These are pre-implemented in withr&amp;rsquo;s &lt;code&gt;local_*()&lt;/code&gt; family of functions. A few examples:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Do / undo this&lt;/th&gt;
&lt;th&gt;withr function&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Create a file&lt;/td&gt;
&lt;td&gt;&lt;code&gt;local_file()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Set an R option&lt;/td&gt;
&lt;td&gt;&lt;code&gt;local_options()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Set an environment variable&lt;/td&gt;
&lt;td&gt;&lt;code&gt;local_envvar()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Change working directory&lt;/td&gt;
&lt;td&gt;&lt;code&gt;local_dir()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&amp;ldquo;Local&amp;rdquo; here refers to the fact that the state change persists only for the lifetime of an associated environment, usually the execution environment of a function or test.&lt;/p&gt;
&lt;p&gt;We can use &lt;code&gt;withr::local_options()&lt;/code&gt; to write yet another version of &lt;code&gt;neat()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;neater &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;function&lt;/span&gt;(x, sig_digits) {
  &lt;span style=&#34;color:#00f&#34;&gt;local_options&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;list&lt;/span&gt;(digits &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; sig_digits))
  &lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(x)
}

&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.141593&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;neater&lt;/span&gt;(&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;, &lt;span style=&#34;color:#666&#34;&gt;3&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.14&lt;/span&gt;

&lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;pi&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 3.141593&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Each &lt;code&gt;local_*()&lt;/code&gt; function has a companion &lt;code&gt;with_()&lt;/code&gt; function, which is a nod to 
&lt;a href=&#34;https://rdrr.io/r/base/with.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;with()&lt;/code&gt;&lt;/a&gt;. We won&amp;rsquo;t use the &lt;code&gt;with_*()&lt;/code&gt; functions here, but you can learn more about them at 
&lt;a href=&#34;http://withr.r-lib.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;withr.r-lib.org&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;test-fixtures&#34;&gt;Test fixtures&lt;/h2&gt;
&lt;p&gt;Testing is often demonstrated with cute little tests and functions where all the inputs and expected results can be inlined. But in real packages, things aren&amp;rsquo;t always so simple. The main functions in your package probably aren&amp;rsquo;t &amp;ldquo;1 number in, 1 number out&amp;rdquo;. They might require more exotic objects or very specific circumstances. Changing state might be the entire purpose of a function! Now what?&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Obligatory caveat: If you find it hard to write tests, this may be the universe telling you that your package has some design problems. Maybe you&amp;rsquo;ve somehow ended up with a small number of monster functions, with oodles of arguments and complex conditional logic, that can do everything from scramble eggs to change a lightbulb. The best move in this case may be to break things up into smaller and simpler functions. And those will be easier to test. End caveat.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Tricky test situations can&amp;rsquo;t always be eliminated by better package design. Let&amp;rsquo;s assume you&amp;rsquo;ve got a reasonable design and you&amp;rsquo;re still facing some test dilemmas. Unless you find a way to make writing tests as pleasant as possible, you won&amp;rsquo;t write nearly enough of them.&lt;/p&gt;
&lt;p&gt;One technique I&amp;rsquo;ve found useful is what I&amp;rsquo;ll call a &lt;strong&gt;self-cleaning test fixture&lt;/strong&gt;.&lt;/p&gt;
&lt;h3 id=&#34;usethis-and-create_local_package&#34;&gt;usethis and &lt;code&gt;create_local_package()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;The usethis package (
&lt;a href=&#34;https://usethis.r-lib.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;usethis.r-lib.org&lt;/a&gt;) provides functions for looking after the files and folders in an R project, especially an R package. These function names should give you a vague sense of what usethis does: &lt;code&gt;create_package()&lt;/code&gt;, &lt;code&gt;use_vignette()&lt;/code&gt;, &lt;code&gt;use_testthat()&lt;/code&gt;, &lt;code&gt;use_github()&lt;/code&gt;. Many of these functions only make sense in the context of an R package. That means in order to test them, we have to be working inside an R package. And they can&amp;rsquo;t all target some persistent Frankenpackage.&lt;/p&gt;
&lt;p&gt;We need a way to quickly spin up a minimal package, in the session temp directory. Test some functions against it. Then destroy it. Without a lot of fuss. We need a &lt;strong&gt;local package&lt;/strong&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;create_local_package &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;function&lt;/span&gt;(dir &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;file_temp&lt;/span&gt;(), env &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;parent.frame&lt;/span&gt;()) {
  old_project &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;proj_get_&lt;/span&gt;()            &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# --- Record starting state --- &lt;/span&gt;
  
  withr&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#00f&#34;&gt;defer&lt;/span&gt;({                        &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# --- Defer The Undoing --- &lt;/span&gt;
    &lt;span style=&#34;color:#00f&#34;&gt;proj_set&lt;/span&gt;(old_project, force &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;TRUE&lt;/span&gt;) &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# restore active usethis project (-C)&lt;/span&gt;
    &lt;span style=&#34;color:#00f&#34;&gt;setwd&lt;/span&gt;(old_project)                  &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# restore working directory      (-B)&lt;/span&gt;
    fs&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#00f&#34;&gt;dir_delete&lt;/span&gt;(dir)                 &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# delete the temporary package   (-A)&lt;/span&gt;
  }, envir &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; env)
                                        &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# --- Do The Doing ---      &lt;/span&gt;
  &lt;span style=&#34;color:#00f&#34;&gt;create_package&lt;/span&gt;(dir, open &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;FALSE&lt;/span&gt;)     &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# create new folder and package  (A)&lt;/span&gt;
  &lt;span style=&#34;color:#00f&#34;&gt;setwd&lt;/span&gt;(dir)                            &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# change working directory       (B)&lt;/span&gt;
  &lt;span style=&#34;color:#00f&#34;&gt;proj_set&lt;/span&gt;(dir)                         &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# switch to new usethis project  (C)&lt;/span&gt;
  &lt;span style=&#34;color:#00f&#34;&gt;invisible&lt;/span&gt;(dir)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&amp;rsquo;s a simplified version of the test helper&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; we use in over 170 tests in usethis. Here&amp;rsquo;s an example of how &lt;code&gt;create_local_package()&lt;/code&gt; is used in a test:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;test_that&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;use_roxygen_md() adds DESCRIPTION fields&amp;#34;&lt;/span&gt;, {
  &lt;span style=&#34;color:#00f&#34;&gt;skip_if_not_installed&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;roxygen2&amp;#34;&lt;/span&gt;)
  
  pkg &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;create_local_package&lt;/span&gt;() &lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;------------------------ HERE IT IS!!!!!&lt;/span&gt;
  
  &lt;span style=&#34;color:#00f&#34;&gt;use_roxygen_md&lt;/span&gt;()
  
  &lt;span style=&#34;color:#00f&#34;&gt;expect_identical&lt;/span&gt;(
    desc&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#00f&#34;&gt;desc_get&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;Roxygen&amp;#34;&lt;/span&gt;, pkg),
    &lt;span style=&#34;color:#00f&#34;&gt;c&lt;/span&gt;(Roxygen &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;list(markdown = TRUE)&amp;#34;&lt;/span&gt;)
  )
  &lt;span style=&#34;color:#00f&#34;&gt;expect_true&lt;/span&gt;(desc&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#00f&#34;&gt;desc_has_fields&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;RoxygenNote&amp;#34;&lt;/span&gt;, pkg))
  &lt;span style=&#34;color:#00f&#34;&gt;expect_true&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;uses_roxygen_md&lt;/span&gt;())
})
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This test checks that &lt;code&gt;usethis::use_roxygen_md()&lt;/code&gt; does the setup necessary to use roxygen2 in a package and, specifically, to write documentation with markdown syntax. All 3 expectations consult the DESCRIPTION file, directly or indirectly. So it&amp;rsquo;s very convenient that &lt;code&gt;create_local_package()&lt;/code&gt; creates a minimal package, with a valid DESCRIPTION file, for us to test against. And when the test is done &amp;ndash; poof! &amp;ndash; the package is gone.&lt;/p&gt;
&lt;p&gt;The setup and teardown done by &lt;code&gt;create_local_package()&lt;/code&gt; would be aggravating and repetitive to inline in each individual test. The tests would be dominated by this code, making them less readable. If we need to tweak something, we&amp;rsquo;d have to do it in hundreds of places. This sort of friction has a real chilling effect on one&amp;rsquo;s enthusiasm for writing and maintaining tests.&lt;/p&gt;
&lt;p&gt;A few more observations about the self-cleaning test fixture pattern:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Every action has an equal and opposite reaction. Each individual &amp;ldquo;doing&amp;rdquo;
action (A) has a matching, deferred &amp;ldquo;undoing&amp;rdquo; reaction (-A).&lt;/li&gt;
&lt;li&gt;We work in this order (usually and preferably):
&lt;ul&gt;
&lt;li&gt;Record existing state.&lt;/li&gt;
&lt;li&gt;Describe the eventual cleanup.&lt;/li&gt;
&lt;li&gt;Make the desired state change.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;The undoing usually unfolds in the opposite order from the doing (&amp;ldquo;last in,
first out&amp;rdquo;). This is almost always OK and it is often absolutely necessary.
In &lt;code&gt;create_local_package()&lt;/code&gt;:
&lt;ul&gt;
&lt;li&gt;Doing: We must create directory &lt;code&gt;dir&lt;/code&gt; (A) before we can make it the
working directory (B). (A) must come before (B).&lt;/li&gt;
&lt;li&gt;Undoing: We must restore the original working directory (-B) before
we can delete &lt;code&gt;dir&lt;/code&gt; (-A). (-B) must come before (-A). We can&amp;rsquo;t delete
&lt;code&gt;dir&lt;/code&gt; while it&amp;rsquo;s still the working directory!&lt;/li&gt;
&lt;li&gt;Think of it like a stack of plates: the last plate onto the stack has to
be the first one off.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Test fixture&lt;/strong&gt; is a pre-existing term in the software engineering world (and beyond):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A test fixture is something used to consistently test some item, device, or piece of software.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&amp;ndash; 
&lt;a href=&#34;https://en.wikipedia.org/wiki/Test_fixture&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;When I first heard &amp;ldquo;test fixture&amp;rdquo; (from GÃ¡bor CsÃ¡rdi, I think), a light bulb clicked on in my head. This was something I &lt;em&gt;knew&lt;/em&gt; I needed and had even implemented in various half-baked ways. But I hadn&amp;rsquo;t identified it as A Real Thing, with specific goals and design principles. It&amp;rsquo;s a great example of 
&lt;a href=&#34;https://blogs.scientificamerican.com/observations/unknown-unknowns-the-problem-of-hypocognition/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hypocognition&lt;/a&gt;. Learning the term &amp;ldquo;test fixture&amp;rdquo; gave me a place to hang this knowledge and allowed me to more quickly identify situations where a test fixture was needed.&lt;/p&gt;
&lt;h3 id=&#34;googlesheets4-and-local_ss&#34;&gt;googlesheets4 and &lt;code&gt;local_ss()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;The googlesheets4 package (
&lt;a href=&#34;https://googlesheets4.tidyverse.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;googlesheets4.tidyverse.org&lt;/a&gt;) provides an R interface to the Google Sheets API. A typical test needs access to a Google Sheet, constructed to have very specific properties and the test may even need to modify the Sheet&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;I need a way to quickly create a Sheet, possibly with very specific initial worksheets, cell data, locale, time zone, etc. Test some functions against it. Then trash it. I need a &lt;em&gt;local spreadsheet&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a simplified version of the helper &lt;code&gt;local_ss()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;local_ss &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;function&lt;/span&gt;(name, &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;...&lt;/span&gt;, env &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;parent.frame&lt;/span&gt;()) {
  existing &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;gs4_find&lt;/span&gt;(name)
  &lt;span style=&#34;color:#00f&#34;&gt;if &lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;nrow&lt;/span&gt;(existing) &lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;0&lt;/span&gt;) {
    &lt;span style=&#34;color:#00f&#34;&gt;stop_glue&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;A spreadsheet named {sq(name)} already exists.&amp;#34;&lt;/span&gt;)
  }

  withr&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#00f&#34;&gt;defer&lt;/span&gt;({
    trash_me &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;gs4_find&lt;/span&gt;(name)
    googledrive&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#00f&#34;&gt;drive_trash&lt;/span&gt;(trash_me)
  }, envir &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; env)
  
  &lt;span style=&#34;color:#00f&#34;&gt;gs4_create&lt;/span&gt;(name, &lt;span style=&#34;color:#008000;font-weight:bold&#34;&gt;...&lt;/span&gt;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Even though the Sheets API is very file-ID-oriented, I go out of my way to work here via Sheet name. I bring this up to illustrate another point: you can also use a helper like this to rationalize your development workflow.&lt;/p&gt;
&lt;p&gt;At first, it feels like &lt;code&gt;local_ss()&lt;/code&gt; should create a new Sheet, store its ID, and then schedule it for deletion. But reality is more messy. As I develop a function and its tests, my experimentation can leave behind several instances of a test Sheet (yes, on Drive, you can have several files with the same name!). This leads to a very cluttered and confusing situation in the test account, requiring a periodic &amp;ldquo;search and destroy&amp;rdquo; mission for zombie test Sheets. Now my helper immediately alerts me to this problem and applies constant pressure to keep things neat and tidy.&lt;/p&gt;
&lt;p&gt;If you keep stubbing your toe in a particular way as you work on your package, zoom out and consider if you can design the problem away by adjusting your workflow. The helper that creates a self-cleaning test fixture is great place to apply this sort of leverage.&lt;/p&gt;
&lt;h2 id=&#34;defer-on-the-global-environment&#34;&gt;&lt;code&gt;defer()&lt;/code&gt; on the global environment&lt;/h2&gt;
&lt;p&gt;I conclude with one more story about workflow. We&amp;rsquo;ve talked about two main functions for registering deferred events: base R&amp;rsquo;s &lt;code&gt;on.exit()&lt;/code&gt; and &lt;code&gt;withr::defer()&lt;/code&gt;. Part of what &lt;code&gt;withr::defer()&lt;/code&gt; offers over &lt;code&gt;on.exit()&lt;/code&gt; is the ability to defer events on &lt;em&gt;any&lt;/em&gt; environment. But there was still a big exception: the global environment.&lt;/p&gt;
&lt;p&gt;Until quite recently, here&amp;rsquo;s what happened if you called &lt;code&gt;defer()&lt;/code&gt; in an interactive R session&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;withr&lt;span style=&#34;color:#666&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#00f&#34;&gt;defer&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;hi&amp;#34;&lt;/span&gt;))
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Error in withr::defer(print(&amp;#34;hi&amp;#34;)):&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;   attempt to defer event on global environment&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;packageVersion&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;withr&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#39;2.1.2&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Frankly, this makes a lot of sense. Deferred events are triggered when an environment goes out of scope. &lt;code&gt;on.exit()&lt;/code&gt; and &lt;code&gt;defer()&lt;/code&gt; are meant to be used in an ephemeral environment, like a function execution environment. Deferring events on the global environment is pretty weird.&lt;/p&gt;
&lt;p&gt;But what about your interactive development of functions and tests? Every time you hit a call to &lt;code&gt;defer()&lt;/code&gt; or &lt;code&gt;local_*()&lt;/code&gt;, that code fails to execute. You&amp;rsquo;re forced to develop your logic at arm&amp;rsquo;s length or implement the intent of the &lt;code&gt;local_*()&lt;/code&gt; calls manually. If you&amp;rsquo;re doing quite a bit of work via &lt;code&gt;local_*()&lt;/code&gt; or &lt;code&gt;on.exit()&lt;/code&gt;, this presents a problem. Basically, it&amp;rsquo;s harder to develop with functions that work one way inside a function, but another way in the global environment (or, worse, don&amp;rsquo;t work at all). &lt;code&gt;substitute()&lt;/code&gt; is another example of this.&lt;/p&gt;
&lt;p&gt;As of withr v2.2.0, you can &lt;code&gt;defer()&lt;/code&gt; events on the global environment, which means that &lt;code&gt;local_*()&lt;/code&gt; functions work too. This is still a pretty weird thing to do, which is why you get a message about how to trigger execution.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;library&lt;/span&gt;(withr)

&lt;span style=&#34;color:#00f&#34;&gt;packageVersion&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;withr&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#39;2.2.0&amp;#39;&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;defer&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;hi&amp;#34;&lt;/span&gt;))
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Setting deferred event(s) on global environment.&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;   * Execute (and clear) with `deferred_run()`.&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;   * Clear (without executing) with `deferred_clear()`.&lt;/span&gt;

&lt;span style=&#34;color:#00f&#34;&gt;deferred_run&lt;/span&gt;()
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] &amp;#34;hi&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Since the global environment isn&amp;rsquo;t perishable, like a test environment is, you have to call &lt;code&gt;deferred_run()&lt;/code&gt; explicitly to execute the deferred events. You can also clear them, without running, with &lt;code&gt;deferred_clear()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This new capability is especially handy with self-cleaning test fixtures, like &lt;code&gt;create_local_package()&lt;/code&gt; and &lt;code&gt;local_ss()&lt;/code&gt; shown above. Sometimes you have to change global state while developing tests, e.g. change working directory or create test Sheets. But now there&amp;rsquo;s a way to run the associated cleanup on demand.&lt;/p&gt;
&lt;h2 id=&#34;recap&#34;&gt;Recap&lt;/h2&gt;
&lt;p&gt;We&amp;rsquo;ve demonstrated that it&amp;rsquo;s a problem to change state in a function or test. Obviously there are exceptions if, for example, that is the whole point of the function.&lt;/p&gt;
&lt;p&gt;The most common and recommended solution to this is to use &lt;code&gt;on.exit()&lt;/code&gt; to organize the necessary cleanup, i.e. restore the original state. However, &lt;code&gt;on.exit()&lt;/code&gt; has some inherent limitations.&lt;/p&gt;
&lt;p&gt;If this sort of setup/teardown happens frequently in the functions and tests in a package, it makes sense to write a custom helper. This function should follow the conventions of the &lt;code&gt;local_*()&lt;/code&gt; functions in withr and will presumably be built around &lt;code&gt;withr::defer()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There is some cost to using a custom &lt;code&gt;local_*()&lt;/code&gt; helper, as it is one more thing to maintain and that all contributors must understand. Consider whether the pros outweigh the cons when adding another layer of abstraction.&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;It&amp;rsquo;s too bad &lt;code&gt;add = TRUE&lt;/code&gt; isn&amp;rsquo;t the default, because you almost always want this. Without it, each call to &lt;code&gt;on.exit()&lt;/code&gt; clobbers the effect of previous calls. &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Note: the &lt;code&gt;after&lt;/code&gt; argument of &lt;code&gt;on.exit()&lt;/code&gt; first appeared in R 3.5.0. &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;code&gt;create_local_package()&lt;/code&gt; is a test helper. The testthat package allows such things to be defined in &lt;code&gt;tests/testthat/helper.R&lt;/code&gt; and then makes them available within package tests. They are also loaded by &lt;code&gt;devtools::load_all()&lt;/code&gt;. &lt;code&gt;tests/testthat/helper.R&lt;/code&gt; is also a great place to define custom expectations. &lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;You might ask about mocking here, but I usually don&amp;rsquo;t embrace that heavily and, in any case, that is a topic for another day. &lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;For all practical purposes, you get the same result with &lt;code&gt;on.exit()&lt;/code&gt;. It&amp;rsquo;s just a silent no-op. &lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>roxygen2 7.1.0</title>
      <link>/blog/2020/03/roxygen2-7-1-0/</link>
      <pubDate>Wed, 11 Mar 2020 00:00:00 +0000</pubDate>
      <guid>/blog/2020/03/roxygen2-7-1-0/</guid>
      <description>&lt;p&gt;We&amp;rsquo;re chuffed to announce the release of 
&lt;a href=&#34;https://roxygen2.r-lib.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;roxygen2 7.1.0&lt;/a&gt;.
roxygen2 allows you to write specially formatted R comments that generate R documentation files (&lt;code&gt;man/*.Rd&lt;/code&gt;) and the &lt;code&gt;NAMESPACE&lt;/code&gt; file.
roxygen2 is used by over 8,800 CRAN packages.&lt;/p&gt;
&lt;p&gt;Install the latest version of roxygen2 with:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;install.packages&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;roxygen2&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This is a minor release, with many small improvements and bug fixes, and some new features.
This blog post discusses the most important changes. See the 
&lt;a href=&#34;https://roxygen2.r-lib.org/news/index.html#roxygen2-7-1-0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;full changelog&lt;/a&gt; for all changes.&lt;/p&gt;
&lt;h2 id=&#34;roxygen2-meets-knitr&#34;&gt;roxygen2 meets knitr&lt;/h2&gt;
&lt;p&gt;We have been gradually improving roxygen2&amp;rsquo;s markdown support, and this release has an exciting new markdown feature as well.
Starting from roxygen2 7.1.0 you can write inline R code and markdown code fences directly in roxygen2 comments!
roxygen2 runs the R code and inserts its output into the documentation.&lt;/p&gt;
&lt;h3 id=&#34;inline-r-code&#34;&gt;Inline R code&lt;/h3&gt;
&lt;p&gt;For running R code inline, use the usual markdown backticks, and prefix the code with &lt;code&gt;r&lt;/code&gt; and a space character.
roxygen2 interprets the rest of the text within backticks as R code, evaluates it, and replaces the backtick expression with its value.
After all such substitutions, the text of the whole tag is interpreted as markdown, as usual.&lt;/p&gt;
&lt;p&gt;For example, the following code inserts the date and the R version of the roxygen2 run.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; roxygen2 created this manual page on `r Sys.Date()` using R version&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; `r getRversion()`.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;code-blocks-fences&#34;&gt;Code blocks (fences)&lt;/h3&gt;
&lt;p&gt;Markdown code blocks can be dynamic as well, if you use &lt;code&gt;```{r}&lt;/code&gt; to start them, just like in knitr documents.
roxygen evaluates the code, and (by default) both the code and the printed value of the expression will be inserted into the manual page.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; ```{r}&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; # This block of code will be evaluated&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; summary(iris)&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; ```&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Code blocks support knitr chunk options, e.g. to keep the output of several expressions together, you can specify &lt;code&gt;results= &amp;quot;hold&amp;quot;&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; ```{r results = &amp;#34;hold&amp;#34;}&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; names(mtcars)&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; nrow(mtcars)&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; ```&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;By default plots create &lt;code&gt;.png&lt;/code&gt; files in the &lt;code&gt;man/figures&lt;/code&gt; directory. The file names are created from the chunk names:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; ```{r r-cookbook-barplot}&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; # https://r-graphics.org/recipe-distribution-basic-hist&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; library(ggplot2)&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; ggplot(faithful, aes(x = waiting)) +&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39;   geom_histogram()&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;#39; ```&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Both the inline R code and the markdown code fences are evaluated when you run &lt;code&gt;devtools::document()&lt;/code&gt; (or &lt;code&gt;roxygenize()&lt;/code&gt;).
You probably want to avoid lengthy computations, or set up caching to keep your package development workflow snappy.&lt;/p&gt;
&lt;p&gt;Please see &lt;code&gt;vignette(&amp;quot;rd-formatting&amp;quot;)&lt;/code&gt; for more about dynamic documentation, including potential caveats.&lt;/p&gt;
&lt;h2 id=&#34;line-ending-conversion&#34;&gt;Line ending conversion&lt;/h2&gt;
&lt;p&gt;This version of roxygen2 does a much better job at keeping the line ending characters consistent within each file, across operating systems.
In particular, if a generated file has only Windows (CR LF) line endings, roxygen2 keeps the file that way.
If a file has mixed Windows and Unix (LF) line endings, roxygen2 converts all line endings to Unix (LF).
For new files roxygen2 uses LF file endings.
If you want to convert a file from CR LF line endings to LF, simply remove it and let roxygen2 re-create it.&lt;/p&gt;
&lt;p&gt;The new convention works better with git on Windows.
Windows git, depending on configuration, might or might not convert between CR LF and LF line endings when checking out and when committing code.
No matter which git option you use, roxygen2 now does not introduce spurious line ending changes.&lt;/p&gt;
&lt;p&gt;Thanks to 
&lt;a href=&#34;https://github.com/jonthegeek&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@jonthegeek&lt;/a&gt; and 
&lt;a href=&#34;https://github.com/jimhester&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@jimhester&lt;/a&gt; for working on this feature.&lt;/p&gt;
&lt;h2 id=&#34;some-other-improvements&#34;&gt;Some other improvements&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Hyperlinks to R6 methods are also added in the PDF manual.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;@description NULL&lt;/code&gt; and &lt;code&gt;@details NULL&lt;/code&gt; no longer fail; instead, these tags
are ignored, except for &lt;code&gt;@description NULL&lt;/code&gt; in package level documentation,
where it can be used to suppress the auto-generated &amp;lsquo;Description&amp;rsquo; section.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Multiple &lt;code&gt;@format&lt;/code&gt; tags are now combined.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;@evalNamespace()&lt;/code&gt; works again.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;acknowledgements&#34;&gt;Acknowledgements&lt;/h2&gt;
&lt;p&gt;A big thanks to all 40 contributors who helped make this release possible! 
&lt;a href=&#34;https://github.com/alandipert&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@alandipert&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/allenzhuaz&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@allenzhuaz&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/BenEngbers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@BenEngbers&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/bgctw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@bgctw&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/billdenney&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@billdenney&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/Bisaloo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@Bisaloo&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/cboettig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@cboettig&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/dmurdoch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@dmurdoch&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/dragosmg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@dragosmg&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/eddelbuettel&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@eddelbuettel&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/gaborcsardi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@gaborcsardi&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/genomaths&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@genomaths&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/goldingn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@goldingn&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/hadley&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@hadley&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/HenrikBengtsson&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@HenrikBengtsson&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/Hong-Revo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@Hong-Revo&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/hughjonesd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@hughjonesd&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/iferres&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@iferres&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/IndrajeetPatil&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@IndrajeetPatil&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/jameslamb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@jameslamb&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/jimhester&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@jimhester&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/kingaa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@kingaa&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/kortschak&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@kortschak&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/krlmlr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@krlmlr&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/maelle&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@maelle&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/michaelquinn32&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@michaelquinn32&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/mikemahoney218&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@mikemahoney218&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/mstr3336&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@mstr3336&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/muschellij2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@muschellij2&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/nteetor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@nteetor&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/ntguardian&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@ntguardian&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/pat-s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@pat-s&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/RaphaelS1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@RaphaelS1&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/russHyde&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@russHyde&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/s-fleck&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@s-fleck&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/stefanfritsch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@stefanfritsch&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/strboul&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@strboul&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/TomKellyGenetics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@TomKellyGenetics&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/VPetukhov&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@VPetukhov&lt;/a&gt;, and 
&lt;a href=&#34;https://github.com/zachary-foster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@zachary-foster&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>vroom 1.1.0</title>
      <link>/blog/2020/01/vroom-1-1-0/</link>
      <pubDate>Wed, 15 Jan 2020 00:00:00 +0000</pubDate>
      <guid>/blog/2020/01/vroom-1-1-0/</guid>
      <description>&lt;p&gt;I&amp;rsquo;m excited to announce that 
&lt;a href=&#34;http://vroom.r-lib.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vroom 1.1.0&lt;/a&gt; is now
available on CRAN!&lt;/p&gt;
&lt;p&gt;vroom reads rectangular data, such as comma separated (csv), tab separated (tsv) or fixed width files (fwf) into R.
It performs similar roles to functions like 
&lt;a href=&#34;http://readr.r-lib.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;readr::read_csv()&lt;/code&gt;&lt;/a&gt;, 
&lt;a href=&#34;http://r-datatable.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;data.table::fread()&lt;/code&gt;&lt;/a&gt; or &lt;code&gt;read.csv()&lt;/code&gt;.
But for many datasets &lt;code&gt;vroom::vroom()&lt;/code&gt; can read them much, much faster (hence the name).
Get the latest version with:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;install.packages&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;vroom&amp;#34;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And attach the package by running&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;library&lt;/span&gt;(vroom)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Improvements in this release include: a hex logo, support for big integer data, improved delimiter guessing, including delimiters in specifications, and streamlined reading from standard input.&lt;/p&gt;
&lt;p&gt;See the 
&lt;a href=&#34;https://vroom.r-lib.org/news/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;change log&lt;/a&gt; for a full list of changes and bug fixes in this version.&lt;/p&gt;
&lt;h2 id=&#34;hex-logo&#34;&gt;Hex logo&lt;/h2&gt;
&lt;p&gt;Thanks to 
&lt;a href=&#34;https://github.com/allisonhorst/stats-illustrations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Allison Horst&lt;/a&gt; we now have an awesome hex logo for vroom!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;logo.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;big-integer-support&#34;&gt;Big integer support&lt;/h2&gt;
&lt;p&gt;R&amp;rsquo;s standard integers are stored in 32 bits of binary data, which means that the largest value they can store is 2,147,483,647 (&lt;code&gt;2^31 - 1&lt;/code&gt;).
R implicitly converts integers for most operations with doubles to 64-bit floating point values, which is why you may not have noticed this limitation before.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;options&lt;/span&gt;(digits &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;22&lt;/span&gt;)
x &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;2147483647L&lt;/span&gt;
&lt;span style=&#34;color:#00f&#34;&gt;str&lt;/span&gt;(x)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;  int 2147483647&lt;/span&gt;
&lt;span style=&#34;color:#00f&#34;&gt;str&lt;/span&gt;(x &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;1L&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Warning in x + 1L: NAs produced by integer overflow&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;  int NA&lt;/span&gt;
&lt;span style=&#34;color:#00f&#34;&gt;str&lt;/span&gt;(x &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;  num 2.15e+09&lt;/span&gt;
x &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 2147483648&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;However, even 64-bit floating point values can only store consecutive integers up to 9,007,199,254,740,992 (&lt;code&gt;2^53&lt;/code&gt;) without losing precision.
You can observe this because if you try adding 1 to this number you will get the same number.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;y &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;9007199254740992&lt;/span&gt;
z &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; y &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;
z
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 9007199254740992&lt;/span&gt;
y &lt;span style=&#34;color:#666&#34;&gt;==&lt;/span&gt; z
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] TRUE&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To store consecutive integers bigger than this you need to use a 64-bit integer type.
R does not have native support for 64-bit integers, however the 
&lt;a href=&#34;https://cran.r-project.org/package=bit64&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bit64&lt;/a&gt; package provides support for them.
Because these integers are so large, they rarely occur in real world data, however they can often be obtained from generated data, such as database identifiers.&lt;/p&gt;
&lt;p&gt;vroom 1.1.0 now supports reading these big integers into the &lt;code&gt;integer64&lt;/code&gt; type provided by bit64 with a new &lt;code&gt;col_big_integer()&lt;/code&gt; column type (shortcut &amp;lsquo;I&amp;rsquo;).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;x &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;vroom&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;id\n9007199254740993\n&amp;#34;&lt;/span&gt;, col_type &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;I&amp;#34;&lt;/span&gt;, delim &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;,&amp;#34;&lt;/span&gt;)
x
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; # A tibble: 1 x 1&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;   id              &lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;   &amp;lt;int64&amp;gt;         &lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; 1 9007199254740993&lt;/span&gt;

x&lt;span style=&#34;color:#666&#34;&gt;$&lt;/span&gt;id &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; integer64&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 9007199254740994&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;improved-delimiter-guessing&#34;&gt;Improved delimiter guessing&lt;/h2&gt;
&lt;p&gt;The code to guess delimiters has been rewritten, which should make it more robust to most inputs.
Previous versions of vroom would fall back to using a newline delimiter if a delimiter could not be guessed.
vroom 1.1.0 instead throws an error.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#00f&#34;&gt;vroom&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;x\n1\n&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Error: Could not guess the delimiter.&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; &lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Use `vroom(delim =)` to specify one explicitly.&lt;/span&gt;
&lt;span style=&#34;color:#00f&#34;&gt;vroom&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;x\n1\n&amp;#34;&lt;/span&gt;, delim &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;,&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Rows: 1&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Columns: 1&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Delimiter: &amp;#34;,&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; dbl [1]: x&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; &lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Use `spec()` to retrieve the guessed column specification&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Pass a specification to the `col_types` argument to quiet this message&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; # A tibble: 1 x 1&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;       x&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt;   &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; 1     1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;delimiters-in-the-specification&#34;&gt;Delimiters in the specification&lt;/h2&gt;
&lt;p&gt;vroom now includes the delimiter in the specification object, which means you no longer have to separately provide the delimiter if you are using an existing specification.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# read a csv file, the delimiter is provided as &amp;#39;,&amp;#39;&lt;/span&gt;
x &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;vroom&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;vroom_example&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;mtcars.csv&amp;#34;&lt;/span&gt;), delim &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#39;,&amp;#39;&lt;/span&gt;)
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Rows: 32&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Columns: 12&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Delimiter: &amp;#34;,&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; chr [ 1]: model&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; dbl [11]: mpg, cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; &lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Use `spec()` to retrieve the guessed column specification&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; Pass a specification to the `col_types` argument to quiet this message&lt;/span&gt;
mtcars_spec &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;spec&lt;/span&gt;(x)

&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;# If the file is read again with the spec, no need to provide the delimiter&lt;/span&gt;
y &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#00f&#34;&gt;vroom&lt;/span&gt;(&lt;span style=&#34;color:#00f&#34;&gt;vroom_example&lt;/span&gt;(&lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#34;mtcars.csv&amp;#34;&lt;/span&gt;), col_types &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; mtcars_spec)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;reading-from-standard-input&#34;&gt;Reading from standard input&lt;/h2&gt;
&lt;p&gt;vroom makes it straightforward to read from the C standard input, like you would do when calling R from the terminal command line.
Simply use &lt;code&gt;stdin()&lt;/code&gt; as your input. Let&amp;rsquo;s say you want to take the first few lines the mtcars file and find the average horsepower.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;head mtcars.tsv | Rscript -e &lt;span style=&#34;color:#ba2121&#34;&gt;&amp;#39;hp &amp;lt;- vroom::vroom(stdin(), col_types = list())$hp; mean(hp)&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color:#408080;font-style:italic&#34;&gt;#&amp;gt; [1] 122.7778&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;acknowledgements&#34;&gt;Acknowledgements&lt;/h2&gt;
&lt;p&gt;This release also contains a number of bug fixes and improvements which should make it more robust than previous releases. See the 
&lt;a href=&#34;https://vroom.r-lib.org/news/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;change log&lt;/a&gt; for full details.&lt;/p&gt;
&lt;p&gt;A big thanks to all contributors of code, issues and documentation to this release, including many who helped out at the tidyverse developer day in Toulouse, France!&lt;/p&gt;
&lt;p&gt;
&lt;a href=&#34;https://github.com/2005m&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@2005m&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/atomman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@atomman&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/batpigandme&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@batpigandme&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/blairj09&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@blairj09&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/Chris-M-P&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@Chris-M-P&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/chsafouane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@chsafouane&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/CriscelyLP&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@CriscelyLP&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/DyfanJones&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@DyfanJones&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/ecoquant&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@ecoquant&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/edzer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@edzer&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/ericbrownaustin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@ericbrownaustin&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/estroger34&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@estroger34&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/frm1789&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@frm1789&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/georgevbsantiago&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@georgevbsantiago&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/guiastrennec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@guiastrennec&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/hadley&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@hadley&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/HenrikBengtsson&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@HenrikBengtsson&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/henry090&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@henry090&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/jaapwalhout&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@jaapwalhout&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/jimhester&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@jimhester&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/jonaszierer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@jonaszierer&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/kiernann&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@kiernann&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/martindut&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@martindut&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/meta00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@meta00&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/mgirlich&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@mgirlich&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/mllg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@mllg&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/osiris08&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@osiris08&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/Plebejer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@Plebejer&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/R3myG&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@R3myG&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/randomgambit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@randomgambit&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/sanromd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@sanromd&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/Shians&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@Shians&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/stephen-hayne&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@stephen-hayne&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/vjcitn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@vjcitn&lt;/a&gt;, 
&lt;a href=&#34;https://github.com/wlattner&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@wlattner&lt;/a&gt;, and 
&lt;a href=&#34;https://github.com/xiaodaigh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@xiaodaigh&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
